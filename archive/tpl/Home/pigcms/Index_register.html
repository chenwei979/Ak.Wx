<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>登陆与注册－{pigcms:$f_siteTitle}</title>
        <link href="{pigcms:$staticPath}/tpl/Home/pigcms/common/css/public.css" rel="stylesheet" type="text/css" />
        <script src="{pigcms:$staticPath}/tpl/Home/pigcms/common/js/jquery.js" type="text/javascript"></script>
        <script src="{pigcms:$staticPath}/tpl/Home/pigcms/common/js/daohang.js" type="text/javascript"></script>
        <script src="{pigcms:$staticPath}/tpl/Home/pigcms/common/js/send.js" type="text/javascript"></script>
        <link href="{pigcms:$staticPath}/tpl/Home/pigcms/common/css/manage.css" rel="stylesheet" type="text/css" />
		<link href="{pigcms:$staticPath}/tpl/Home/pigcms/common/css/new_index.css" rel="stylesheet" type="text/css" />
		<script src="http://cdn.bootcss.com/jquery/1.11.2/jquery.min.js"></script>
		<script src="{pigcms:$staticPath}/tpl/Home/pigcms/common/js/bootstrap.min.js"></script>
    </head>
    <style>
    input[type="text"] {
     text-indent: 10px;    
    }
    input[type="password"] {
     text-indent: 10px; 
    }
    .select_01_01{width:150px;height: 40px;text-align:center;color:#6e6e6e;padding-left: 30px }

    .congtX button{background: #ed523e}

    </style>
    
    <body>
    	<!--startof header-->
    	<include file="Public:header03"/>
        <!--ENDOF header-->
        
        <!--startof content-->
        <div class="content clr">
        	<div class="congtS clr">
            	<div class="t">
                	您还没有注册，注册后即可直接体验或创建和管理微信营销系统

                </div>
            </div>
            <!--end congtX-->
            <div class="congtX">
                <!--end left-->
                
                
                
                <div class="contRt regbox clr">
                	 <form action="{pigcms::U('Users/checkreg')}" method="post" class="login">
                        <p class="clr"></p>
                        <if condition="C('reg_mp_verify') eq 0">
                            <div class="name clr">
                                <span>
                                    用户名
                                </span>
                                <input class="text" required="" value="请输入用户名" onclick="if(this.value=='请输入用户名'){this.value=''}"
                                onblur="if(this.value==''){this.value='请输入用户名'}" type="text" name="username">
                            </div>
                            <div class="password clr">
                                <span>
                                    密码
                                </span>
                                <input class="text" type="password" name="password">
                            </div>
                            <div class="aginword clr">
                                <span>
                                    重复密码
                                </span>
                                <input class="text" type="password" name="repassword">
                            </div>
                            <div class="teliphone clr">
                                <span>
                                    手机
                                </span>
                                <input class="text" type="text" placeholder="请输入手机号码" onblur="checkMP()"
                                id="sms_mp" name="mp" />
                            </div>
                            <div class="youxiang clr">
                                <span>
                                    邮箱
                                </span>
                                <input class="text" type="text" name="email" value="" onclick="if(this.value=='请输入电子邮箱'){this.value=''}"
                                onblur="if(this.value==''){this.value=''}">
                            </div>
                        <div class="aginword clr">
                            <span >图片验证</span>
                            <input class="text verification" required=""  placeholder="请输入验证码"  type="text" name="imgVerify" id="imgVerify"/>
                            &nbsp;<img src="{pigcms::U('Index/verify')}" id="txtCheckCode" style="width:70px;cursor: pointer" onclick="refreshImg2();" />
                            <script>
                                function refreshImg2(){
                                    document.getElementById("txtCheckCode").src="/index.php?g=Home&m=Index&a=verify&s="+Math.random();
                                }
                            </script>
                        </div>
                            <else />
                            <div class="teliphone clr">
                                <span>
                                    手机
                                </span>
                                <input class="text" type="text" placeholder="请输入手机号码" onblur="checkMP()"
                                id="sms_mp" name="mp" />
                            </div>
                            <div class="name clr">
                                <span>
                                    用户名
                                </span>
                                <input class="text" required="" placeholder="请输入用户名" type="text" name="username">
                            </div>
                            <div class="password clr">
                                <span>
                                    密码
                                </span>
                                <input class="text" type="password" name="password">
                            </div>
                            <div class="aginword clr">
                                <span>
                                    重复密码
                                </span>
                                <input class="text" type="password" name="repassword">
                            </div>
                            <div class="duanxin clr">
                                <span style="margin-left: -86px;">
                                    短信验证
                                </span>
                                <input type="text" class="text" name="verifycode" style="width:80px" maxlength="6"
                                />
                                <span id="a_verify" style="margin-left:5px">
                                    <a href="###" onclick="sendMsg()" id="a_btn">
                                        获取验证码
                                    </a>
                                </span>
                            </div>
                        </if>
                        <input class="text" type="hidden" name="invitecode" value="<?php echo $_GET['invitecode'];?>">
                        <button class="submit" type="submit" class="buttom" style=" margin-left:84px;">
                            注册
                        </button>
                    </form>
					<if condition="$slogin ==1">
                    <div class="slogin">
                    <a href="slogin.html" class="btn-orange_active2 btn-block">直接进入体验...</a>
                    </div>
                    </if>
                </div>
				<script>
            function checkMP() {

                jQuery(function($) {

                    var mp = $('#sms_mp').val();

                    var reg = /^0{0,1}1[0-9]{10}$/i;

                    if (mp == '' || !reg.test(mp)) {

                        alert('请输入正确的手机号！');

                        return false;

                    } else {

                        $.ajax({

                            url: "{pigcms::U('Users/checkMP')}",

                            type: "post",

                            data: "mp=" + mp,

                            success: function(data) {

                                if (data == 1) {

                                    alert('这个手机号已经注册过了，直接登录就可以喽。');

                                    $("#a_verify").html("手机号已被注册");

                                    return false;

                                } else {

                                    $("#a_verify").css({
                                        "background": "#fff",
                                        "borderColor": "#007DDB"
                                    });

                                    $("#a_verify").html('<a href="###" onclick="sendMsg()" id="a_btn" >获取验证码</a>');

                                }

                            }

                        });

                    }

                });

            }

            function refreshImg() {

                document.getElementById("txtCheckCode").src = "/index.php?g=Home&m=Index&a=verify&s=" + Math.random();

            }

            function sendMsg() {

                var num = document.getElementById('sms_mp').value;

                var reg = /^0{0,1}1[0-9]{10}$/i;

                if (num == '' || !reg.test(num)) {

                    alert('请输入正确的手机号！');

                    return false;

                }

                if (confirm("我们会将会发送验证码到 " + num)) {

                    jQuery(function($) {

                        $.ajax({

                            url: "{pigcms::U('Users/sendMsg')}",

                            type: "post",

                            data: "mp=" + num,

                            success: function(data) {

                                $("#a_verify").css({
                                    "background": "#ccc",
                                    "borderColor": "#ccc"
                                });

                                fun_timedown(60);

                            }

                        });

                    });

                }

                return false;

            }

            function fun_timedown(time) {

                if (time == 'undefined') {

                    time = 60;

                }

                $("#a_verify").html(time + "秒后可重新获取");

                time = time - 1;

                if (time >= 0) {

                    setTimeout("fun_timedown(" + time + ")", 1000);

                } else {

                    $("#a_verify").css({
                        "background": "#fff",
                        "borderColor": "#007DDB"
                    });

                    $("#a_verify").html('<a href="###" onclick="sendMsg()" id="a_btn" >获取验证码</a>');

                }

            }
        </script>
                <!--end right-->
                <p style="border-right:1px solid #E3E3E3; width:1px; float:left; height:330px; padding-left:20px;"></p>
                <div class="contRt clr">
					<div class="title">已有账号？</div>
                    <a class="btnbox" href="{pigcms::U('Index/login')}">马上登陆</a>

                </div>
            </div>
        </div>
        
        <!--endof content-->
        
        
        <!--footer-->
        	<include file="Public:footer03"/>
    </body>
</html>
